## 유저를 매칭하는 법

- LIFF로 들어온 라인 유저와 서비스 유저를 매칭할 필요가 있는 경우가 있다.

### 기존 서비스의 유저를 매칭하지 않는 방법

- LIFF의 엑세스 토큰을 통해서 유저의 라인 아이디를 취득할 수 있다. 이 아이디를 서비스의 로그인 아이디로 하여 서비스의 유저를 만들 수 있다.
- 서버는 LIFF에서 토큰을 받아서 해당 토큰으로 아이디를 확인한 후 이미 등록된 라인 아이디인 경우 서비스에 로그인 되도록 만든다.
- 이 방법은 간단한 편에 속하는데 왜냐하면 기존에 서비스에 라인 아이디 없이 등록된 아이디와 라인 아이디를 매칭하는 단계 없이 서비스의 모든 유저 생성 방식이 라인을 기반으로 하기 때문이다.

### 기존 서비스의 유저를 매칭하는 방법

- LIFF의 단점은 라인 내부에서 실행된다는 것이다. LIFF로 접근한 유저의 아이디를 취득할 수 있으므로 LIFF 웹에서 서비스 유저의 아이디 비밀번호를 입력해서 로그인을 하는 방법이 있지만 아이디와 비밀번호에 대한 정보가 라인의 로그에 저장될 수 있다. LIFF는 라인 애플리케이션 내부에서 실행되는 웹이기 때문에 웹에서 일어나는 사항에 대해 정보를 취득할 수 있다. 따라서 비밀번와 같은 민감한 정보는 어플 내부 브라우저에서 입력하지 않도록 하는 것이 좋고, 애플리케이션 내에서 실행되었을 때에는 입력하지 않도록 하는 것이 중요하다. 카카오톡, 인스타그램 등에서 웹을 열면 사파리나 크롬과 같은 브라우저에서 열리는 것이 어플리케이션 내부에서 열리는데 이는 사용자의 웹 접근 정보를 취득할 수 있기 때문이다.
- LIFF에서 아이디와 비밀번호를 입력하지 않는다면 어떻게 기존 서비스의 유저 아이디와 라인 아이디를 매칭할 수 있을까? LIFF에서는 로그인 아이디만 받고 비밀번호는 입력하지 않는 방법이 있다. 비밀번호를 입력하지 않는다면, 전화번호나 메일 등의 방식으로 인증을 해야 한다.

#### 서비스에서 QR 코드 제공

- 중요한 것은 기존에 서비스에 등록된 유저인지 확인하기 위함이다. 기존 서비스에 로그인을 한 뒤, 서비스 화면에서 로그인된 유저의 정보가 담긴 QR 코드를 보여주고 스마트폰으로 QR 코드를 읽어서 LIFF 앱을 여는 방법을 사용할 수 있다.
- QR 코드는 LIFF의 LIFF ID에 부여된 `https://liff.line.me`으로 시작하는 URL을 제공하되, 쿼리 스트링을 통해서 `?service_user_id=암호화된_유저_식별자`의 방식으로 QR 코드를 만들고 이 QR 코드를 읽은 유저가 LIFF의 웹을 라인에서 열면 LIFF의 토큰과 `암호화된_유저_식별자`를 서비스 서버에 보내어 라인 아이디에 매칭되는 서비스 유저 정보를 저장하는 방식을 사용할 수 있다.
- QR 코드를 활용한 방식은 별도의 스마트폰 이외의 모니터가 있을 때 인증이 가능하다. 서비스에 로그인 한 웹에서 발급된 QR 코드를 직접 읽어야 하기 때문이다. 그렇지 않으면, 웹에서 QR이 아닌 방법으로 `https://liff.line.me/라인_LIFF_식별자?service_user_id=암호화된_유저_식별자`의 URL을 복사하여 라인 채팅창에 붙여넣는 방식으로 인증을 할 수도 있다.
